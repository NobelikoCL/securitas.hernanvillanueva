{% extends "pwa_base.html" %}
{% load widget_tweaks %}

{% block title %}{{ titulo_pagina }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>{{ titulo_pagina }}</h2>
    <hr>

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {% endfor %}
    {% endif %}

    <p>Sube un archivo CSV o Excel (.xlsx) con los datos del personal. Asegúrate de que el archivo tenga las siguientes columnas en el orden especificado:</p>
    <p><code>nombre, apellido, rut, fecha_nacimiento (YYYY-MM-DD), direccion, telefono_contacto, acepta_mensajeria_whatsapp (SI/NO), legajo, fecha_ingreso (YYYY-MM-DD), instalacion_trabajo_nombre, centro_costo_codigo, usuario_username (opcional)</code></p>
    <p><strong>Notas importantes:</strong></p>
    <ul>
        <li>El RUT debe tener el formato XX.XXX.XXX-X o XXXXXXXX-X.</li>
        <li>Las fechas deben estar en formato AAAA-MM-DD.</li>
        <li>Para "acepta_mensajeria_whatsapp", usa "SI" o "NO".</li>
        <li>"instalacion_trabajo_nombre" debe ser el nombre exacto de una instalación existente. Si se deja en blanco o no se encuentra, no se asignará.</li>
        <li>"centro_costo_codigo" debe ser el código exacto de un centro de costo existente. Si se deja en blanco o no se encuentra, no se asignará.</li>
        <li>"usuario_username" es opcional. Si se proporciona, se intentará asociar con un usuario existente.</li>
        <li>La primera fila del archivo debe ser la cabecera con los nombres de las columnas.</li>
    </ul>


    <form method="post" enctype="multipart/form-data" class="mt-3">
        {% csrf_token %}
        <div class="mb-3">
            <label for="{{ form.file.id_for_label }}" class="form-label">{{ form.file.label }}</label>
            {{ form.file|add_class:"form-control" }}
            {% if form.file.errors %}
                <div class="invalid-feedback d-block">
                    {{ form.file.errors|join:", " }}
                </div>
            {% endif %}
        </div>

        <button type="submit" class="btn btn-primary">Subir y Procesar Archivo</button>
        <a href="{% url 'flota_app:personal_list' %}" class="btn btn-secondary">Cancelar y Volver al Listado</a>
    </form>

</div>
{% endblock %}
