{% extends "pwa_base.html" %}
{% load crispy_forms_tags %}

{% block title %}{{ titulo_pagina }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">{{ titulo_pagina }}</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <a href="{% url 'flota_app:cliente_create' %}" class="btn btn-sm btn-outline-primary">
            Añadir Nuevo Cliente
        </a>
    </div>
</div>

{% if clientes %}
<div class="table-responsive">
    <table class="table table-striped table-sm">
        <thead>
            <tr>
                <th>Nombre</th>
                <th>RUT</th>
                <th>Teléfono</th>
                <th>Email</th>
                <th>Centros de Costo</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for cliente_obj in clientes %} {# Renombrado para evitar conflicto con la variable de contexto 'cliente' en otras plantillas #}
            <tr>
                <td>{{ cliente_obj.nombre }}</td>
                <td>{{ cliente_obj.rut }}</td>
                <td>{{ cliente_obj.telefono|default_if_none:"" }}</td>
                <td>{{ cliente_obj.email|default_if_none:"" }}</td>
                <td>
                    <a href="{% url 'flota_app:centrocosto_list_by_cliente' cliente_obj.pk %}" class="btn btn-sm btn-outline-info">
                        Ver ({{ cliente_obj.centros_costo.count }})
                    </a>
                </td>
                <td>
                    <a href="{% url 'flota_app:cliente_update' cliente_obj.pk %}" class="btn btn-sm btn-warning">Editar</a>
                    <a href="{% url 'flota_app:cliente_delete' cliente_obj.pk %}" class="btn btn-sm btn-danger">Eliminar</a>
                    {# Podríamos añadir un botón "Gestionar" que lleve a una vista detalle del cliente con más opciones #}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="alert alert-info" role="alert">
    No hay clientes registrados. <a href="{% url 'flota_app:cliente_create' %}">Puedes añadir uno nuevo</a>.
</div>
{% endif %}

<hr>
<a href="{% url 'flota_app:dashboard' %}" class="btn btn-secondary">Volver al Dashboard</a>

{% endblock %}
